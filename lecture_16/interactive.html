<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬16å›ï¼šã¾ã¨ã‚ - åˆ¶å¾¡å·¥å­¦ç·åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #58a6ff; --green: #3fb950; --yellow: #d29922; --red: #f85149; --purple: #a371f7; --text: #c9d1d9; --dim: #8b949e; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans JP', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        .container { max-width: 1500px; margin: 0 auto; padding: 1.5rem; }
        header { text-align: center; padding: 2rem 0; background: linear-gradient(135deg, rgba(88,166,255,0.1), rgba(163,113,247,0.1)); border-radius: 16px; margin-bottom: 1.5rem; }
        h1 { font-size: 2.2rem; background: linear-gradient(135deg, var(--accent), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
        .card { background: var(--card); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); }
        .card-wide { grid-column: span 2; }
        .card-full { grid-column: 1 / -1; }
        .card-title { color: var(--accent); margin-bottom: 1rem; font-size: 1.1rem; }
        canvas { width: 100%; height: 250px; border-radius: 8px; background: rgba(0,0,0,0.3); }
        .btn { padding: 0.5rem 1rem; background: var(--accent); border: none; border-radius: 6px; color: #0d1117; font-weight: 500; cursor: pointer; margin: 0.2rem; font-size: 0.85rem; }
        .btn:hover { opacity: 0.9; }
        .btn.active { background: var(--green); }
        .slider-group { margin: 0.6rem 0; }
        .slider-group label { display: flex; justify-content: space-between; color: var(--dim); font-size: 0.85rem; }
        input[type="range"] { width: 100%; margin-top: 0.3rem; }
        .result-box { background: rgba(88,166,255,0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 0.8rem; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; margin: 0.5rem 0; }
        .topic-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.8rem; }
        .topic-item { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 0.8rem; text-align: center; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
        .topic-item:hover { background: rgba(88,166,255,0.15); }
        .topic-item.active { border-color: var(--accent); background: rgba(88,166,255,0.2); }
        .topic-num { font-size: 0.75rem; color: var(--dim); }
        .topic-name { font-size: 0.85rem; margin-top: 0.3rem; }
        .legend { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem; font-size: 0.8rem; }
        .legend-item { display: flex; align-items: center; gap: 0.3rem; }
        .legend-dot { width: 12px; height: 3px; border-radius: 2px; }
        .info-box { background: rgba(63,185,80,0.1); border-left: 3px solid var(--green); padding: 0.75rem; font-size: 0.85rem; margin: 0.5rem 0; }
        .formula { background: rgba(0,0,0,0.4); padding: 0.6rem; border-radius: 6px; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; text-align: center; margin: 0.5rem 0; }
        @media (max-width: 1100px) { .grid { grid-template-columns: repeat(2, 1fr); } .card-wide { grid-column: span 1; } .topic-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 700px) { .grid { grid-template-columns: 1fr; } .card-wide { grid-column: span 1; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>åˆ¶å¾¡å·¥å­¦ ç·åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <p style="color: var(--dim); margin-top: 0.5rem;">State-Space Control Theory - Interactive Summary</p>
        </header>
        
        <div class="grid">
            <!-- ãƒˆãƒ”ãƒƒã‚¯é¸æŠ -->
            <div class="card card-full">
                <h3 class="card-title">ğŸ“š è¬›ç¾©ãƒˆãƒ”ãƒƒã‚¯ä¸€è¦§</h3>
                <div class="topic-grid">
                    <div class="topic-item active" onclick="selectTopic(1)"><div class="topic-num">ç¬¬1å›</div><div class="topic-name">çŠ¶æ…‹ç©ºé–“è¡¨ç¾</div></div>
                    <div class="topic-item" onclick="selectTopic(2)"><div class="topic-num">ç¬¬2å›</div><div class="topic-name">PIDåˆ¶å¾¡</div></div>
                    <div class="topic-item" onclick="selectTopic(3)"><div class="topic-num">ç¬¬3å›</div><div class="topic-name">çŠ¶æ…‹æ–¹ç¨‹å¼ã®è§£</div></div>
                    <div class="topic-item" onclick="selectTopic(4)"><div class="topic-num">ç¬¬4å›</div><div class="topic-name">é·ç§»è¡Œåˆ—</div></div>
                    <div class="topic-item" onclick="selectTopic(5)"><div class="topic-num">ç¬¬5å›</div><div class="topic-name">ä¼é”é–¢æ•°</div></div>
                    <div class="topic-item" onclick="selectTopic(6)"><div class="topic-num">ç¬¬6å›</div><div class="topic-name">å®‰å®šæ€§ã¨æ¥µ</div></div>
                    <div class="topic-item" onclick="selectTopic(7)"><div class="topic-num">ç¬¬7å›</div><div class="topic-name">ãƒªã‚¢ãƒ—ãƒãƒ•</div></div>
                    <div class="topic-item" onclick="selectTopic(8)"><div class="topic-num">ç¬¬8å›</div><div class="topic-name">å¯åˆ¶å¾¡æ€§</div></div>
                    <div class="topic-item" onclick="selectTopic(9)"><div class="topic-num">ç¬¬9å›</div><div class="topic-name">å¯è¦³æ¸¬æ€§</div></div>
                    <div class="topic-item" onclick="selectTopic(10)"><div class="topic-num">ç¬¬10å›</div><div class="topic-name">æ¥µé…ç½®</div></div>
                    <div class="topic-item" onclick="selectTopic(11)"><div class="topic-num">ç¬¬11å›</div><div class="topic-name">ã‚ªãƒ–ã‚¶ãƒ¼ãƒ</div></div>
                    <div class="topic-item" onclick="selectTopic(12)"><div class="topic-num">ç¬¬12å›</div><div class="topic-name">LQR</div></div>
                    <div class="topic-item" onclick="selectTopic(13)"><div class="topic-num">ç¬¬13å›</div><div class="topic-name">ãƒªãƒƒã‚«ãƒæ–¹ç¨‹å¼</div></div>
                    <div class="topic-item" onclick="selectTopic(14)"><div class="topic-num">ç¬¬14å›</div><div class="topic-name">ã‚«ãƒ«ãƒãƒ³ãƒ•ã‚£ãƒ«ã‚¿</div></div>
                    <div class="topic-item" onclick="selectTopic(15)"><div class="topic-num">ç¬¬15å›</div><div class="topic-name">ã‚µãƒ¼ãƒœç³»</div></div>
                    <div class="topic-item" onclick="selectTopic(16)"><div class="topic-num">ç¬¬16å›</div><div class="topic-name">ã¾ã¨ã‚</div></div>
                </div>
            </div>
            
            <!-- çµ±åˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="card card-wide">
                <h3 class="card-title">ğŸ® çµ±åˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                <canvas id="mainCanvas" style="height: 280px;"></canvas>
                <div class="legend">
                    <div class="legend-item"><div class="legend-dot" style="background: var(--accent);"></div>çŠ¶æ…‹ xâ‚</div>
                    <div class="legend-item"><div class="legend-dot" style="background: var(--green);"></div>çŠ¶æ…‹ xâ‚‚</div>
                    <div class="legend-item"><div class="legend-dot" style="background: var(--yellow);"></div>å‚ç…§/æ¨å®š</div>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š -->
            <div class="card">
                <h3 class="card-title">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>
                <div class="slider-group">
                    <label>æ¸›è¡°æ¯” Î¶: <span id="zetaVal">0.5</span></label>
                    <input type="range" id="zeta" min="0.1" max="2" step="0.1" value="0.5">
                </div>
                <div class="slider-group">
                    <label>å›ºæœ‰æŒ¯å‹•æ•° Ï‰n: <span id="wnVal">2.0</span></label>
                    <input type="range" id="wn" min="0.5" max="5" step="0.1" value="2">
                </div>
                <div class="slider-group">
                    <label>ã‚²ã‚¤ãƒ³ K: <span id="gainVal">1.0</span></label>
                    <input type="range" id="gain" min="0.1" max="5" step="0.1" value="1">
                </div>
                <button class="btn" onclick="runSimulation()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
            </div>
            
            <!-- æ¥µé…ç½®å›³ -->
            <div class="card">
                <h3 class="card-title">ğŸ“ æ¥µé…ç½®ï¼ˆså¹³é¢ï¼‰</h3>
                <canvas id="poleCanvas"></canvas>
            </div>
            
            <!-- é‡è¦å…¬å¼ -->
            <div class="card">
                <h3 class="card-title" id="formulaTitle">ğŸ“ é‡è¦å…¬å¼</h3>
                <div id="formulaContent">
                    <div class="formula">áº‹ = Ax + Bu</div>
                    <div class="formula">y = Cx + Du</div>
                    <div class="info-box" id="formulaDesc">
                        çŠ¶æ…‹ç©ºé–“è¡¨ç¾ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å†…éƒ¨çŠ¶æ…‹ã‚’æ˜ç¤ºçš„ã«æ‰±ã†ç¾ä»£åˆ¶å¾¡ã®åŸºæœ¬å½¢å¼ã§ã™ã€‚
                    </div>
                </div>
            </div>
            
            <!-- æ¦‚å¿µãƒãƒƒãƒ— -->
            <div class="card">
                <h3 class="card-title">ğŸ—ºï¸ æ¦‚å¿µã®é–¢ä¿‚</h3>
                <canvas id="mapCanvas"></canvas>
            </div>
            
            <!-- ã‚·ã‚¹ãƒ†ãƒ ç‰¹æ€§ -->
            <div class="card card-full">
                <h3 class="card-title">ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ç‰¹æ€§ã‚µãƒãƒªãƒ¼</h3>
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem;">
                    <div class="result-box">
                        <strong>å®‰å®šæ€§</strong><br>
                        <span id="stability" style="color: var(--green);">âœ“ å®‰å®š</span><br>
                        <span style="font-size: 0.75rem;">Re(Î») < 0</span>
                    </div>
                    <div class="result-box">
                        <strong>å¯åˆ¶å¾¡æ€§</strong><br>
                        <span id="controllability" style="color: var(--green);">âœ“ å¯åˆ¶å¾¡</span><br>
                        <span style="font-size: 0.75rem;">rank(C) = n</span>
                    </div>
                    <div class="result-box">
                        <strong>å¯è¦³æ¸¬æ€§</strong><br>
                        <span id="observability" style="color: var(--green);">âœ“ å¯è¦³æ¸¬</span><br>
                        <span style="font-size: 0.75rem;">rank(O) = n</span>
                    </div>
                    <div class="result-box">
                        <strong>æ¥µ</strong><br>
                        <span id="poles">-1 Â± 1.73j</span><br>
                        <span style="font-size: 0.75rem;">å›ºæœ‰å€¤</span>
                    </div>
                    <div class="result-box">
                        <strong>æ•´å®šæ™‚é–“</strong><br>
                        <span id="settlingTime">4.0 s</span><br>
                        <span style="font-size: 0.75rem;">â‰ˆ 4/Î¶Ï‰n</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentTopic = 1;
        let zeta = 0.5, wn = 2, gain = 1;
        
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const poleCanvas = document.getElementById('poleCanvas');
        const poleCtx = poleCanvas.getContext('2d');
        const mapCanvas = document.getElementById('mapCanvas');
        const mapCtx = mapCanvas.getContext('2d');
        
        const topicData = {
            1: { title: 'çŠ¶æ…‹ç©ºé–“è¡¨ç¾', formulas: ['áº‹ = Ax + Bu', 'y = Cx + Du'], desc: 'çŠ¶æ…‹ç©ºé–“è¡¨ç¾ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å†…éƒ¨çŠ¶æ…‹ã‚’æ˜ç¤ºçš„ã«æ‰±ã†ç¾ä»£åˆ¶å¾¡ã®åŸºæœ¬å½¢å¼ã§ã™ã€‚' },
            2: { title: 'PIDåˆ¶å¾¡', formulas: ['u = KpÂ·e + KiÂ·âˆ«e + KdÂ·Ä—'], desc: 'æ¯”ä¾‹ãƒ»ç©åˆ†ãƒ»å¾®åˆ†ã®3è¦ç´ ã§æ§‹æˆã•ã‚Œã‚‹å¤å…¸çš„ã‹ã¤å®Ÿç”¨çš„ãªåˆ¶å¾¡æ‰‹æ³•ã§ã™ã€‚' },
            3: { title: 'çŠ¶æ…‹æ–¹ç¨‹å¼ã®è§£', formulas: ['x(t) = eá´¬áµ—xâ‚€ + âˆ«eá´¬â½áµ—â»Ï„â¾Bu(Ï„)dÏ„'], desc: 'åˆæœŸçŠ¶æ…‹ã¨å…¥åŠ›ã‹ã‚‰çŠ¶æ…‹ã®æ™‚é–“ç™ºå±•ã‚’æ±‚ã‚ã‚‹åŸºæœ¬è§£ã§ã™ã€‚' },
            4: { title: 'é·ç§»è¡Œåˆ—', formulas: ['Î¦(t) = eá´¬áµ— = Lâ»Â¹{(sI-A)â»Â¹}'], desc: 'çŠ¶æ…‹é·ç§»ã‚’è¨˜è¿°ã™ã‚‹è¡Œåˆ—ã€‚ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›ã‚„å¯¾è§’åŒ–ã§è¨ˆç®—ã—ã¾ã™ã€‚' },
            5: { title: 'ä¼é”é–¢æ•°', formulas: ['G(s) = C(sI-A)â»Â¹B + D'], desc: 'çŠ¶æ…‹ç©ºé–“è¡¨ç¾ã‹ã‚‰ä¼é”é–¢æ•°ã¸ã®å¤‰æ›å…¬å¼ã§ã™ã€‚æ¥µã¨å›ºæœ‰å€¤ãŒä¸€è‡´ã—ã¾ã™ã€‚' },
            6: { title: 'å®‰å®šæ€§ã¨æ¥µ', formulas: ['Re(Î»áµ¢) < 0 âŸº æ¼¸è¿‘å®‰å®š'], desc: 'ã™ã¹ã¦ã®å›ºæœ‰å€¤ã®å®Ÿéƒ¨ãŒè² ã§ã‚ã‚Œã°ã€ã‚·ã‚¹ãƒ†ãƒ ã¯æ¼¸è¿‘å®‰å®šã§ã™ã€‚' },
            7: { title: 'ãƒªã‚¢ãƒ—ãƒãƒ•æ–¹ç¨‹å¼', formulas: ['Aáµ€P + PA = -Q'], desc: 'ãƒªã‚¢ãƒ—ãƒãƒ•é–¢æ•° V(x)=xáµ€Px ãŒæ¸›å°‘ã™ã‚Œã°å®‰å®šæ€§ãŒè¨¼æ˜ã•ã‚Œã¾ã™ã€‚' },
            8: { title: 'å¯åˆ¶å¾¡æ€§', formulas: ['C = [B | AB | AÂ²B | ...]', 'rank(C) = n âŸº å¯åˆ¶å¾¡'], desc: 'ä»»æ„ã®çŠ¶æ…‹ã¸åˆ°é”å¯èƒ½ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚æ¥µé…ç½®ã®å‰ææ¡ä»¶ã§ã™ã€‚' },
            9: { title: 'å¯è¦³æ¸¬æ€§', formulas: ['O = [C; CA; CAÂ²; ...]áµ€', 'rank(O) = n âŸº å¯è¦³æ¸¬'], desc: 'å‡ºåŠ›ã‹ã‚‰çŠ¶æ…‹ã‚’æ¨å®šå¯èƒ½ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚ã‚ªãƒ–ã‚¶ãƒ¼ãƒè¨­è¨ˆã®å‰ææ¡ä»¶ã§ã™ã€‚' },
            10: { title: 'æ¥µé…ç½®', formulas: ['u = -Kx', 'det(sI - A + BK) = ç›®æ¨™ç‰¹æ€§å¤šé …å¼'], desc: 'çŠ¶æ…‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚Šé–‰ãƒ«ãƒ¼ãƒ—æ¥µã‚’ä»»æ„ã®ä½ç½®ã«é…ç½®ã§ãã¾ã™ã€‚' },
            11: { title: 'ã‚ªãƒ–ã‚¶ãƒ¼ãƒ', formulas: ['xÌ‚Ì‡ = AxÌ‚ + Bu + L(y - CxÌ‚)'], desc: 'æ¸¬å®šã§ããªã„çŠ¶æ…‹ã‚’å‡ºåŠ›ã‹ã‚‰æ¨å®šã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚' },
            12: { title: 'LQR', formulas: ['J = âˆ«(xáµ€Qx + uáµ€Ru)dt', 'K = Râ»Â¹Báµ€P'], desc: 'è©•ä¾¡é–¢æ•°ã‚’æœ€å°åŒ–ã™ã‚‹æœ€é©ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚²ã‚¤ãƒ³ã‚’æ±‚ã‚ã¾ã™ã€‚' },
            13: { title: 'ãƒªãƒƒã‚«ãƒæ–¹ç¨‹å¼', formulas: ['Aáµ€P + PA - PBRâ»Â¹Báµ€P + Q = 0'], desc: 'LQRã®æœ€é©ã‚²ã‚¤ãƒ³ã‚’æ±‚ã‚ã‚‹ãŸã‚ã®ä»£æ•°æ–¹ç¨‹å¼ã§ã™ã€‚' },
            14: { title: 'ã‚«ãƒ«ãƒãƒ³ãƒ•ã‚£ãƒ«ã‚¿', formulas: ['L = PCáµ€Ráµ¥â»Â¹'], desc: 'ãƒã‚¤ã‚ºãŒã‚ã‚‹ç’°å¢ƒã§ã®æœ€é©çŠ¶æ…‹æ¨å®šã‚’è¡Œã„ã¾ã™ã€‚LQRã¨åŒå¯¾é–¢ä¿‚ã«ã‚ã‚Šã¾ã™ã€‚' },
            15: { title: 'ã‚µãƒ¼ãƒœç³»', formulas: ['u = -KxÂ·x - KiÂ·âˆ«(r-y)dt'], desc: 'ç›®æ¨™å€¤è¿½å¾“ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ç©åˆ†å‹•ä½œã‚’å«ã‚€æ‹¡å¤§ç³»ã§è¨­è¨ˆã—ã¾ã™ã€‚' },
            16: { title: 'ã¾ã¨ã‚', formulas: ['çŠ¶æ…‹ç©ºé–“æ³•ã®ä½“ç³»'], desc: '16å›ã®è¬›ç¾©ã§å­¦ã‚“ã å†…å®¹ã‚’çµ±åˆçš„ã«ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚' }
        };
        
        function setupCanvas(canvas, ctx) {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }
        
        function selectTopic(num) {
            currentTopic = num;
            document.querySelectorAll('.topic-item').forEach((item, i) => {
                item.classList.toggle('active', i === num - 1);
            });
            updateFormulas();
            runSimulation();
        }
        
        function updateFormulas() {
            const data = topicData[currentTopic];
            document.getElementById('formulaTitle').textContent = 'ğŸ“ ' + data.title;
            let html = '';
            data.formulas.forEach(f => {
                html += `<div class="formula">${f}</div>`;
            });
            html += `<div class="info-box">${data.desc}</div>`;
            document.getElementById('formulaContent').innerHTML = html;
        }
        
        function runSimulation() {
            zeta = parseFloat(document.getElementById('zeta').value);
            wn = parseFloat(document.getElementById('wn').value);
            gain = parseFloat(document.getElementById('gain').value);
            
            document.getElementById('zetaVal').textContent = zeta.toFixed(1);
            document.getElementById('wnVal').textContent = wn.toFixed(1);
            document.getElementById('gainVal').textContent = gain.toFixed(1);
            
            // ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—ã®æ›´æ–°
            const A = [[0, 1], [-wn*wn, -2*zeta*wn]];
            const B = [0, wn*wn];
            
            // æ¥µã®è¨ˆç®—
            const disc = zeta*zeta - 1;
            let polesStr;
            if (disc >= 0) {
                const p1 = -zeta*wn + wn*Math.sqrt(disc);
                const p2 = -zeta*wn - wn*Math.sqrt(disc);
                polesStr = `${p1.toFixed(2)}, ${p2.toFixed(2)}`;
            } else {
                polesStr = `${(-zeta*wn).toFixed(2)} Â± ${(wn*Math.sqrt(-disc)).toFixed(2)}j`;
            }
            document.getElementById('poles').textContent = polesStr;
            
            // å®‰å®šæ€§åˆ¤å®š
            const isStable = zeta > 0;
            document.getElementById('stability').innerHTML = isStable ? 
                '<span style="color: var(--green);">âœ“ å®‰å®š</span>' : 
                '<span style="color: var(--red);">âœ— ä¸å®‰å®š</span>';
            
            // æ•´å®šæ™‚é–“
            const ts = 4 / (zeta * wn);
            document.getElementById('settlingTime').textContent = ts.toFixed(2) + ' s';
            
            drawMain(A, B);
            drawPoles();
            drawMap();
        }
        
        function drawMain(A, B) {
            const w = mainCanvas.getBoundingClientRect().width;
            const h = mainCanvas.getBoundingClientRect().height;
            mainCtx.fillStyle = 'rgba(0,0,0,0.3)';
            mainCtx.fillRect(0, 0, w, h);
            
            const margin = { top: 20, right: 20, bottom: 30, left: 40 };
            const plotW = w - margin.left - margin.right;
            const plotH = h - margin.top - margin.bottom;
            
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const dt = 0.02;
            const maxT = 10;
            const data = [];
            let x1 = 0, x2 = 0;
            let maxX = 1;
            
            for (let t = 0; t <= maxT; t += dt) {
                const r = t >= 0.5 ? 1 : 0;
                const u = gain * (r - x1);
                
                data.push({ t, x1, x2, r });
                maxX = Math.max(maxX, Math.abs(x1), Math.abs(x2));
                
                const dx1 = A[0][0]*x1 + A[0][1]*x2 + B[0]*u;
                const dx2 = A[1][0]*x1 + A[1][1]*x2 + B[1]*u;
                x1 += dx1 * dt;
                x2 += dx2 * dt;
            }
            
            const toX = (t) => margin.left + (t / maxT) * plotW;
            const toY = (x) => margin.top + plotH/2 - (x / (maxX * 1.2)) * (plotH/2);
            
            // ã‚°ãƒªãƒƒãƒ‰
            mainCtx.strokeStyle = 'rgba(255,255,255,0.1)';
            mainCtx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                mainCtx.beginPath();
                mainCtx.moveTo(margin.left, margin.top + (plotH/4)*i);
                mainCtx.lineTo(w - margin.right, margin.top + (plotH/4)*i);
                mainCtx.stroke();
            }
            
            // å‚ç…§
            mainCtx.strokeStyle = 'var(--yellow)';
            mainCtx.lineWidth = 1;
            mainCtx.setLineDash([5, 5]);
            mainCtx.beginPath();
            data.forEach((d, i) => {
                if (i === 0) mainCtx.moveTo(toX(d.t), toY(d.r));
                else mainCtx.lineTo(toX(d.t), toY(d.r));
            });
            mainCtx.stroke();
            mainCtx.setLineDash([]);
            
            // x1
            mainCtx.strokeStyle = 'var(--accent)';
            mainCtx.lineWidth = 2;
            mainCtx.beginPath();
            data.forEach((d, i) => {
                if (i === 0) mainCtx.moveTo(toX(d.t), toY(d.x1));
                else mainCtx.lineTo(toX(d.t), toY(d.x1));
            });
            mainCtx.stroke();
            
            // x2
            mainCtx.strokeStyle = 'var(--green)';
            mainCtx.beginPath();
            data.forEach((d, i) => {
                if (i === 0) mainCtx.moveTo(toX(d.t), toY(d.x2));
                else mainCtx.lineTo(toX(d.t), toY(d.x2));
            });
            mainCtx.stroke();
        }
        
        function drawPoles() {
            const w = poleCanvas.getBoundingClientRect().width;
            const h = poleCanvas.getBoundingClientRect().height;
            poleCtx.fillStyle = 'rgba(0,0,0,0.3)';
            poleCtx.fillRect(0, 0, w, h);
            
            const cx = w * 0.6, cy = h / 2;
            const scale = Math.min(w, h) / 8;
            
            // å®‰å®šé ˜åŸŸ
            poleCtx.fillStyle = 'rgba(63, 185, 80, 0.1)';
            poleCtx.fillRect(0, 0, cx, h);
            
            // è»¸
            poleCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            poleCtx.lineWidth = 1;
            poleCtx.beginPath();
            poleCtx.moveTo(0, cy);
            poleCtx.lineTo(w, cy);
            poleCtx.moveTo(cx, 0);
            poleCtx.lineTo(cx, h);
            poleCtx.stroke();
            
            // æ¥µã®è¨ˆç®—ã¨æç”»
            const disc = zeta*zeta - 1;
            poleCtx.fillStyle = 'var(--accent)';
            
            if (disc >= 0) {
                const p1 = -zeta*wn + wn*Math.sqrt(disc);
                const p2 = -zeta*wn - wn*Math.sqrt(disc);
                [[p1, 0], [p2, 0]].forEach(([re, im]) => {
                    poleCtx.beginPath();
                    poleCtx.arc(cx + re * scale, cy - im * scale, 6, 0, Math.PI * 2);
                    poleCtx.fill();
                });
            } else {
                const re = -zeta * wn;
                const im = wn * Math.sqrt(-disc);
                [[re, im], [re, -im]].forEach(([r, i]) => {
                    poleCtx.beginPath();
                    poleCtx.arc(cx + r * scale, cy - i * scale, 6, 0, Math.PI * 2);
                    poleCtx.fill();
                });
            }
            
            poleCtx.fillStyle = 'var(--dim)';
            poleCtx.font = '10px JetBrains Mono';
            poleCtx.fillText('Re', w - 20, cy - 5);
            poleCtx.fillText('Im', cx + 5, 15);
        }
        
        function drawMap() {
            const w = mapCanvas.getBoundingClientRect().width;
            const h = mapCanvas.getBoundingClientRect().height;
            mapCtx.fillStyle = 'rgba(0,0,0,0.3)';
            mapCtx.fillRect(0, 0, w, h);
            
            const nodes = [
                { x: w*0.5, y: 30, label: 'çŠ¶æ…‹ç©ºé–“', color: 'var(--accent)' },
                { x: w*0.2, y: 90, label: 'å¯åˆ¶å¾¡æ€§', color: 'var(--green)' },
                { x: w*0.8, y: 90, label: 'å¯è¦³æ¸¬æ€§', color: 'var(--green)' },
                { x: w*0.2, y: 150, label: 'æ¥µé…ç½®', color: 'var(--yellow)' },
                { x: w*0.8, y: 150, label: 'ã‚ªãƒ–ã‚¶ãƒ¼ãƒ', color: 'var(--yellow)' },
                { x: w*0.35, y: 210, label: 'LQR', color: 'var(--purple)' },
                { x: w*0.65, y: 210, label: 'ã‚«ãƒ«ãƒãƒ³', color: 'var(--purple)' }
            ];
            
            const edges = [
                [0, 1], [0, 2], [1, 3], [2, 4], [3, 5], [4, 6], [5, 6]
            ];
            
            // ã‚¨ãƒƒã‚¸
            mapCtx.strokeStyle = 'rgba(255,255,255,0.2)';
            mapCtx.lineWidth = 1;
            edges.forEach(([i, j]) => {
                mapCtx.beginPath();
                mapCtx.moveTo(nodes[i].x, nodes[i].y);
                mapCtx.lineTo(nodes[j].x, nodes[j].y);
                mapCtx.stroke();
            });
            
            // ãƒãƒ¼ãƒ‰
            nodes.forEach(n => {
                mapCtx.fillStyle = n.color;
                mapCtx.beginPath();
                mapCtx.arc(n.x, n.y, 5, 0, Math.PI * 2);
                mapCtx.fill();
                
                mapCtx.fillStyle = 'var(--text)';
                mapCtx.font = '11px Noto Sans JP';
                mapCtx.textAlign = 'center';
                mapCtx.fillText(n.label, n.x, n.y + 20);
            });
            
            // åŒå¯¾çŸ¢å°
            mapCtx.strokeStyle = 'var(--purple)';
            mapCtx.lineWidth = 2;
            mapCtx.setLineDash([3, 3]);
            mapCtx.beginPath();
            mapCtx.moveTo(w*0.4, 210);
            mapCtx.lineTo(w*0.6, 210);
            mapCtx.stroke();
            mapCtx.setLineDash([]);
            
            mapCtx.fillStyle = 'var(--dim)';
            mapCtx.font = '9px JetBrains Mono';
            mapCtx.fillText('åŒå¯¾', w*0.5, 225);
        }
        
        ['zeta', 'wn', 'gain'].forEach(id => {
            document.getElementById(id).addEventListener('input', runSimulation);
        });
        
        window.addEventListener('load', () => {
            setupCanvas(mainCanvas, mainCtx);
            setupCanvas(poleCanvas, poleCtx);
            setupCanvas(mapCanvas, mapCtx);
            updateFormulas();
            runSimulation();
        });
        window.addEventListener('resize', () => {
            setupCanvas(mainCanvas, mainCtx);
            setupCanvas(poleCanvas, poleCtx);
            setupCanvas(mapCanvas, mapCtx);
            runSimulation();
        });
    </script>
</body>
</html>
