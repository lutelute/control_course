<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4å›ï¼šé·ç§»è¡Œåˆ—ã®è¨ˆç®—</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #1a1a2e;
            --bg-card: #16213e;
            --accent: #e94560;
            --accent2: #0f3460;
            --cyan: #4fd1c5;
            --yellow: #f6e05e;
            --text: #edf2f7;
            --text-dim: #a0aec0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
        header { text-align: center; padding: 2rem 0; margin-bottom: 2rem; }
        h1 { font-size: 2rem; color: var(--cyan); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card-full { grid-column: 1 / -1; }
        .card-title { color: var(--cyan); margin-bottom: 1rem; font-size: 1.1rem; }
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(2, 70px);
            gap: 0.5rem;
            margin: 0.5rem 0;
        }
        .matrix-grid input {
            padding: 0.5rem;
            background: var(--accent2);
            border: 1px solid var(--cyan);
            border-radius: 4px;
            color: var(--text);
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
        }
        .method-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .tab {
            padding: 0.5rem 1rem;
            background: var(--accent2);
            border: none;
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab.active { background: var(--accent); }
        .tab:hover { opacity: 0.8; }
        .result-box {
            background: rgba(79, 209, 197, 0.1);
            border: 1px solid var(--cyan);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .step-box {
            background: rgba(233, 69, 96, 0.1);
            border-left: 3px solid var(--accent);
            padding: 1rem;
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        canvas { width: 100%; height: 300px; border-radius: 8px; background: rgba(0,0,0,0.2); }
        .slider-group { margin: 1rem 0; }
        .slider-group label { display: block; margin-bottom: 0.3rem; color: var(--text-dim); }
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--accent2);
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--cyan);
            cursor: pointer;
        }
        .btn {
            padding: 0.6rem 1.2rem;
            background: var(--accent);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            margin: 0.25rem;
        }
        .btn:hover { opacity: 0.9; }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.85rem;
        }
        .comparison-table th, .comparison-table td {
            padding: 0.5rem;
            border: 1px solid var(--accent2);
            text-align: center;
        }
        .comparison-table th { background: var(--accent2); }
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç¬¬4å›ï¼šé·ç§»è¡Œåˆ—ã®è¨ˆç®—</h1>
            <p style="color: var(--text-dim);">Computing the State Transition Matrix</p>
        </header>
        
        <div class="grid">
            <div class="card">
                <h3 class="card-title">ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ— A</h3>
                <div class="matrix-grid">
                    <input type="number" id="a11" value="0" step="0.5">
                    <input type="number" id="a12" value="1" step="0.5">
                    <input type="number" id="a21" value="-6" step="0.5">
                    <input type="number" id="a22" value="-5" step="0.5">
                </div>
                <div style="margin-top: 1rem;">
                    <button class="btn" onclick="compute()">è¨ˆç®—å®Ÿè¡Œ</button>
                    <button class="btn" onclick="setExample1()">ä¾‹1: å®Ÿå›ºæœ‰å€¤</button>
                    <button class="btn" onclick="setExample2()">ä¾‹2: è¤‡ç´ å›ºæœ‰å€¤</button>
                </div>
                <div class="result-box" style="margin-top: 1rem;">
                    <div>ç‰¹æ€§æ–¹ç¨‹å¼: det(sI - A) = 0</div>
                    <div id="charEq">sÂ² + 5s + 6 = 0</div>
                    <div style="margin-top: 0.5rem;">å›ºæœ‰å€¤:</div>
                    <div id="eigenvalues">Î»â‚ = -2, Î»â‚‚ = -3</div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="card-title">ğŸ”§ è¨ˆç®—æ–¹æ³•ã®é¸æŠ</h3>
                <div class="method-tabs">
                    <button class="tab active" onclick="selectMethod('laplace')">ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›</button>
                    <button class="tab" onclick="selectMethod('diag')">å¯¾è§’åŒ–</button>
                    <button class="tab" onclick="selectMethod('cayley')">ã‚±ãƒ¼ãƒªãƒ¼ãƒ»ãƒãƒŸãƒ«ãƒˆãƒ³</button>
                    <button class="tab" onclick="selectMethod('series')">ç´šæ•°å±•é–‹</button>
                </div>
                <div id="methodDescription" class="step-box">
                    ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›æ³•: e^(At) = Lâ»Â¹{(sI-A)â»Â¹}
                </div>
            </div>
            
            <div class="card card-full">
                <h3 class="card-title">ğŸ“ è¨ˆç®—ã‚¹ãƒ†ãƒƒãƒ—</h3>
                <div id="steps"></div>
            </div>
            
            <div class="card">
                <h3 class="card-title">ğŸ“ˆ é·ç§»è¡Œåˆ— e^(At)</h3>
                <div class="slider-group">
                    <label>æ™‚åˆ» t = <span id="tVal">1.00</span></label>
                    <input type="range" id="tSlider" min="0" max="3" step="0.05" value="1">
                </div>
                <div class="result-box" id="phiResult">
                    e^(At) = 
                    [  3eâ»Â²áµ— - 2eâ»Â³áµ—    eâ»Â²áµ— - eâ»Â³áµ—  ]
                    [ -6eâ»Â²áµ— + 6eâ»Â³áµ—  -2eâ»Â²áµ— + 3eâ»Â³áµ— ]
                </div>
                <div class="result-box" style="margin-top: 0.5rem;" id="phiNumeric">
                    t = 1.0 ã§ã®æ•°å€¤:
                    [ 0.356   0.086 ]
                    [-0.516   0.135 ]
                </div>
            </div>
            
            <div class="card">
                <h3 class="card-title">ğŸ”¢ æ•°å€¤æ¤œè¨¼</h3>
                <canvas id="verifyCanvas"></canvas>
                <p style="color: var(--text-dim); font-size: 0.85rem; margin-top: 0.5rem;">
                    è§£æè§£ã¨ç´šæ•°å±•é–‹ã®æ¯”è¼ƒï¼ˆä¸€è‡´ã™ã‚Œã°æ­£ã—ã„ï¼‰
                </p>
            </div>
            
            <div class="card card-full">
                <h3 class="card-title">âš–ï¸ è¨ˆç®—æ–¹æ³•ã®æ¯”è¼ƒ</h3>
                <table class="comparison-table">
                    <tr>
                        <th>æ–¹æ³•</th>
                        <th>åˆ©ç‚¹</th>
                        <th>æ¬ ç‚¹</th>
                        <th>é©ç”¨æ¡ä»¶</th>
                    </tr>
                    <tr>
                        <td>ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›</td>
                        <td>ç›´æ¥çš„ã§ç†è«–çš„</td>
                        <td>é€†å¤‰æ›ãŒç…©é›‘</td>
                        <td>ä»»æ„ã®è¡Œåˆ—</td>
                    </tr>
                    <tr>
                        <td>å¯¾è§’åŒ–</td>
                        <td>è¨ˆç®—ãŒç°¡æ½”</td>
                        <td>å¯¾è§’åŒ–ä¸å¯ã®å ´åˆã‚ã‚Š</td>
                        <td>å¯¾è§’åŒ–å¯èƒ½è¡Œåˆ—</td>
                    </tr>
                    <tr>
                        <td>ã‚±ãƒ¼ãƒªãƒ¼ãƒ»ãƒãƒŸãƒ«ãƒˆãƒ³</td>
                        <td>å¸¸ã«é©ç”¨å¯èƒ½</td>
                        <td>é‡æ ¹ã§å ´åˆåˆ†ã‘å¿…è¦</td>
                        <td>ä»»æ„ã®è¡Œåˆ—</td>
                    </tr>
                    <tr>
                        <td>ç´šæ•°å±•é–‹</td>
                        <td>æ•°å€¤è¨ˆç®—å‘ã</td>
                        <td>æ‰“ã¡åˆ‡ã‚Šèª¤å·®</td>
                        <td>ä»»æ„ã®è¡Œåˆ—</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        let A = [[0, 1], [-6, -5]];
        let currentMethod = 'laplace';
        let tValue = 1.0;
        
        const canvas = document.getElementById('verifyCanvas');
        const ctx = canvas.getContext('2d');
        
        function setupCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }
        
        function getA() {
            return [
                [parseFloat(document.getElementById('a11').value), parseFloat(document.getElementById('a12').value)],
                [parseFloat(document.getElementById('a21').value), parseFloat(document.getElementById('a22').value)]
            ];
        }
        
        function eigenvalues2x2(A) {
            const tr = A[0][0] + A[1][1];
            const det = A[0][0]*A[1][1] - A[0][1]*A[1][0];
            const disc = tr*tr - 4*det;
            if (disc >= 0) {
                return [
                    { re: (tr + Math.sqrt(disc))/2, im: 0 },
                    { re: (tr - Math.sqrt(disc))/2, im: 0 }
                ];
            } else {
                return [
                    { re: tr/2, im: Math.sqrt(-disc)/2 },
                    { re: tr/2, im: -Math.sqrt(-disc)/2 }
                ];
            }
        }
        
        function matrixExp(A, t, terms = 30) {
            let result = [[1, 0], [0, 1]];
            let power = [[1, 0], [0, 1]];
            let factorial = 1;
            for (let k = 1; k < terms; k++) {
                power = [
                    [power[0][0]*A[0][0] + power[0][1]*A[1][0], power[0][0]*A[0][1] + power[0][1]*A[1][1]],
                    [power[1][0]*A[0][0] + power[1][1]*A[1][0], power[1][0]*A[0][1] + power[1][1]*A[1][1]]
                ];
                factorial *= k;
                const coef = Math.pow(t, k) / factorial;
                result = [
                    [result[0][0] + power[0][0]*coef, result[0][1] + power[0][1]*coef],
                    [result[1][0] + power[1][0]*coef, result[1][1] + power[1][1]*coef]
                ];
            }
            return result;
        }
        
        function formatComplex(c) {
            if (Math.abs(c.im) < 0.001) return c.re.toFixed(3);
            const sign = c.im >= 0 ? '+' : '-';
            return `${c.re.toFixed(3)} ${sign} ${Math.abs(c.im).toFixed(3)}j`;
        }
        
        function compute() {
            A = getA();
            const eigs = eigenvalues2x2(A);
            const tr = A[0][0] + A[1][1];
            const det = A[0][0]*A[1][1] - A[0][1]*A[1][0];
            
            document.getElementById('charEq').textContent = 
                `sÂ² ${tr >= 0 ? '+' : '-'} ${Math.abs(tr).toFixed(2)}s ${det >= 0 ? '+' : '-'} ${Math.abs(det).toFixed(2)} = 0`;
            document.getElementById('eigenvalues').textContent = 
                `Î»â‚ = ${formatComplex(eigs[0])}, Î»â‚‚ = ${formatComplex(eigs[1])}`;
            
            updateSteps();
            updatePhiResult();
            drawVerification();
        }
        
        function selectMethod(method) {
            currentMethod = method;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const descriptions = {
                'laplace': 'ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›æ³•: e^(At) = Lâ»Â¹{(sI-A)â»Â¹}',
                'diag': 'å¯¾è§’åŒ–æ³•: A = PDPâ»Â¹ ãªã‚‰ã° e^(At) = Pe^(Dt)Pâ»Â¹',
                'cayley': 'ã‚±ãƒ¼ãƒªãƒ¼ãƒ»ãƒãƒŸãƒ«ãƒˆãƒ³: e^(At) = Î±â‚€(t)I + Î±â‚(t)A',
                'series': 'ç´šæ•°å±•é–‹: e^(At) = Î£(At)^k/k!'
            };
            document.getElementById('methodDescription').textContent = descriptions[method];
            updateSteps();
        }
        
        function updateSteps() {
            const A = getA();
            const eigs = eigenvalues2x2(A);
            const tr = A[0][0] + A[1][1];
            const det = A[0][0]*A[1][1] - A[0][1]*A[1][0];
            let html = '';
            
            if (currentMethod === 'laplace') {
                html = `
                <div class="step-box">
                    <strong>Step 1:</strong> sI - A ã‚’è¨ˆç®—<br>
                    sI - A = [s - ${A[0][0]}, ${-A[0][1]}; ${-A[1][0]}, s - ${A[1][1]}]
                </div>
                <div class="step-box">
                    <strong>Step 2:</strong> è¡Œåˆ—å¼ã‚’è¨ˆç®—<br>
                    det(sI - A) = (s - ${A[0][0]})(s - ${A[1][1]}) - (${-A[0][1]})(${-A[1][0]})<br>
                    = sÂ² ${tr >= 0 ? '-' : '+'} ${Math.abs(tr).toFixed(2)}s + ${det.toFixed(2)}
                </div>
                <div class="step-box">
                    <strong>Step 3:</strong> (sI - A)â»Â¹ ã‚’æ±‚ã‚ã‚‹<br>
                    å„è¦ç´ ã‚’éƒ¨åˆ†åˆ†æ•°å±•é–‹ã—ã¦é€†ãƒ©ãƒ—ãƒ©ã‚¹å¤‰æ›
                </div>`;
            } else if (currentMethod === 'diag') {
                html = `
                <div class="step-box">
                    <strong>Step 1:</strong> å›ºæœ‰å€¤ã‚’æ±‚ã‚ã‚‹<br>
                    Î»â‚ = ${formatComplex(eigs[0])}, Î»â‚‚ = ${formatComplex(eigs[1])}
                </div>
                <div class="step-box">
                    <strong>Step 2:</strong> å›ºæœ‰ãƒ™ã‚¯ãƒˆãƒ«ã‹ã‚‰å¤‰æ›è¡Œåˆ— P ã‚’æ§‹æˆ
                </div>
                <div class="step-box">
                    <strong>Step 3:</strong> e^(At) = Pe^(Dt)Pâ»Â¹ ã‚’è¨ˆç®—<br>
                    e^(Dt) = diag(e^(Î»â‚t), e^(Î»â‚‚t))
                </div>`;
            } else if (currentMethod === 'cayley') {
                html = `
                <div class="step-box">
                    <strong>Step 1:</strong> e^(At) = Î±â‚€(t)I + Î±â‚(t)A ã¨ä»®å®š
                </div>
                <div class="step-box">
                    <strong>Step 2:</strong> å›ºæœ‰å€¤ã‚’ä»£å…¥ã—ã¦é€£ç«‹æ–¹ç¨‹å¼<br>
                    e^(Î»â‚t) = Î±â‚€ + Î±â‚Î»â‚<br>
                    e^(Î»â‚‚t) = Î±â‚€ + Î±â‚Î»â‚‚
                </div>
                <div class="step-box">
                    <strong>Step 3:</strong> Î±â‚€, Î±â‚ ã‚’è§£ã„ã¦ä»£å…¥
                </div>`;
            } else {
                html = `
                <div class="step-box">
                    <strong>Step 1:</strong> å®šç¾©å¼ã‚’ç›´æ¥è¨ˆç®—<br>
                    e^(At) = I + At + (At)Â²/2! + (At)Â³/3! + ...
                </div>
                <div class="step-box">
                    <strong>Step 2:</strong> ååˆ†ãªé …æ•°ã§æ‰“ã¡åˆ‡ã‚Šï¼ˆé€šå¸¸20-30é …ï¼‰
                </div>
                <div class="step-box">
                    <strong>Step 3:</strong> æ•°å€¤è¨ˆç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãƒ‘ãƒ‡è¿‘ä¼¼ã‚’ä½¿ç”¨
                </div>`;
            }
            document.getElementById('steps').innerHTML = html;
        }
        
        function updatePhiResult() {
            const phi = matrixExp(A, tValue);
            document.getElementById('phiNumeric').innerHTML = 
                `t = ${tValue.toFixed(2)} ã§ã®æ•°å€¤:<br>` +
                `[ ${phi[0][0].toFixed(4)}   ${phi[0][1].toFixed(4)} ]<br>` +
                `[ ${phi[1][0].toFixed(4)}   ${phi[1][1].toFixed(4)} ]`;
        }
        
        function drawVerification() {
            const w = canvas.getBoundingClientRect().width;
            const h = canvas.getBoundingClientRect().height;
            
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.fillRect(0, 0, w, h);
            
            const margin = { top: 20, right: 20, bottom: 30, left: 50 };
            const plotW = w - margin.left - margin.right;
            const plotH = h - margin.top - margin.bottom;
            
            const maxT = 3;
            const data = [];
            let maxVal = 1;
            
            for (let t = 0; t <= maxT; t += 0.05) {
                const phi = matrixExp(A, t);
                data.push({ t, phi11: phi[0][0], phi12: phi[0][1] });
                maxVal = Math.max(maxVal, Math.abs(phi[0][0]), Math.abs(phi[0][1]));
            }
            maxVal = Math.min(maxVal, 5);
            
            const toX = (t) => margin.left + (t / maxT) * plotW;
            const toY = (v) => margin.top + plotH/2 - (v / maxVal) * (plotH/2);
            
            // ã‚°ãƒªãƒƒãƒ‰
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = margin.top + (plotH / 4) * i;
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(w - margin.right, y);
                ctx.stroke();
            }
            
            // Î¦â‚â‚
            ctx.strokeStyle = '#4fd1c5';
            ctx.lineWidth = 2;
            ctx.beginPath();
            data.forEach((p, i) => {
                const clamped = Math.max(-maxVal, Math.min(maxVal, p.phi11));
                if (i === 0) ctx.moveTo(toX(p.t), toY(clamped));
                else ctx.lineTo(toX(p.t), toY(clamped));
            });
            ctx.stroke();
            
            // Î¦â‚â‚‚
            ctx.strokeStyle = '#e94560';
            ctx.beginPath();
            data.forEach((p, i) => {
                const clamped = Math.max(-maxVal, Math.min(maxVal, p.phi12));
                if (i === 0) ctx.moveTo(toX(p.t), toY(clamped));
                else ctx.lineTo(toX(p.t), toY(clamped));
            });
            ctx.stroke();
            
            // ç¾åœ¨æ™‚åˆ»ãƒãƒ¼ã‚«ãƒ¼
            ctx.strokeStyle = '#f6e05e';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(toX(tValue), margin.top);
            ctx.lineTo(toX(tValue), h - margin.bottom);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ãƒ©ãƒ™ãƒ«
            ctx.fillStyle = '#4fd1c5';
            ctx.font = '12px JetBrains Mono';
            ctx.fillText('Î¦â‚â‚', w - 50, 30);
            ctx.fillStyle = '#e94560';
            ctx.fillText('Î¦â‚â‚‚', w - 50, 50);
        }
        
        function setExample1() {
            document.getElementById('a11').value = 0;
            document.getElementById('a12').value = 1;
            document.getElementById('a21').value = -6;
            document.getElementById('a22').value = -5;
            compute();
        }
        
        function setExample2() {
            document.getElementById('a11').value = 0;
            document.getElementById('a12').value = 1;
            document.getElementById('a21').value = -5;
            document.getElementById('a22').value = -2;
            compute();
        }
        
        document.getElementById('tSlider').addEventListener('input', (e) => {
            tValue = parseFloat(e.target.value);
            document.getElementById('tVal').textContent = tValue.toFixed(2);
            updatePhiResult();
            drawVerification();
        });
        
        window.addEventListener('load', () => {
            setupCanvas();
            compute();
        });
        window.addEventListener('resize', () => { setupCanvas(); drawVerification(); });
    </script>
</body>
</html>
